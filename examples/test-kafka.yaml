testcase: "Kafka Messaging Test"
description: "Test Kafka publish and consume with immediate connection management"

# Prerequisites: Create topic first
# docker exec kafka kafka-topics.sh --create --topic test-topic --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1

steps:
  - name: "Log start"
    action: log
    args: ["Testing Kafka messaging..."]

  - name: "Publish message to Kafka"
    action: kafka
    args: ["publish", "localhost:9092", "test-topic", "Hello from Robogo!"]
    result: publish_result

  - name: "Consume message from Kafka"
    action: kafka
    args: ["consume", "localhost:9092", "test-topic"]
    result: message

  - name: "Verify message content"
    action: assert
    args: ["${message.message}", "==", "Hello from Robogo!"]

  - name: "Log completion"
    action: log
    args: ["Kafka test completed successfully"]