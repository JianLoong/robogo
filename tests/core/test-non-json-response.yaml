testcase: "Non-JSON HTTP Response Test"
description: "Test how the system handles non-JSON HTTP responses"

variables:
  vars:
    http_url: "http://localhost:8000"
    https_url: "https://httpbin.org"

steps:
  # Test 1: HTML response from httpbin
  - name: "Get HTML response"
    action: http
    args: ["GET", "https://httpbin.org/html"]
    result: "html_response"

  - name: "Check HTML response status code"
    action: assert
    args: ["${html_response.status_code}", "==", "200", "HTML response should have 200 status"]

  - name: "Log HTML response body"
    action: log
    args: ["${html_response.body}"]

  # Test 2: XML response from httpbin
  - name: "Get XML response"
    action: http
    args: ["GET", "https://httpbin.org/xml"]
    result: "xml_response"

  - name: "Check XML response status code"
    action: assert
    args: ["${xml_response.status_code}", "==", "200", "XML response should have 200 status"]

  - name: "Log XML response body"
    action: log
    args: ["XML Body: ${xml_response.body}"]

  - name: "Log text response body"
    action: log
    args: ["Text Body: ${text_response.body}"]

  # Test 4: Retry with non-JSON response that returns server error
  - name: "Retry with HTML 500 error"
    action: http
    args: ["GET", "https://httpbin.org/status/500"]
    retry:
      attempts: 2
      delay: 1s
      conditions: ["5xx"]
    result: "html_500_response"

  - name: "Check HTML 500 response status code"
    action: assert
    args: ["${html_500_response.status_code}", "==", "500", "HTML 500 response should have 500 status"]