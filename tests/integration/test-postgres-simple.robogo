testcase: "Postgres Simple Test"
description: "Simple test to verify Postgres connection and compare with Spanner"

variables:
  vars:
    postgres_host: "192.168.0.174"
    postgres_port: "5432"
    postgres_user: "user1"
    postgres_database: "testdb"
  secrets:
    db_password:
      file: "secret.txt"
      mask_output: false

steps:
  - name: "Build connection string"
    action: concat
    args: ["postgres://", "${postgres_user}", ":", "${db_password}", "@", "${postgres_host}", ":", "${postgres_port}", "/", "${postgres_database}", "?sslmode=disable"]
    result: postgres_connection

  - name: "Connect to Postgres"
    action: postgres
    args:
      - "connect"
      - "${postgres_connection}"
    result: connection_result

  - name: "Simple query test"
    action: postgres
    args:
      - "query"
      - "${postgres_connection}"
      - "SELECT 1 as test_value"
    result: query_result

  - name: "Verify test value is 1"
    action: assert
    args: ["${query_result.value}", "==", 1, "Should return test value of 1"]

  - name: "Close Postgres connection"
    action: postgres
    args:
      - "close"
      - "${postgres_connection}"
    result: close_result 